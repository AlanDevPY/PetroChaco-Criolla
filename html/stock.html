<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gesti√≥n de Stock</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/roles.css">

    <!-- Toastify CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>

<body class="d-flex flex-column min-vh-100 bg-light">

    <!-- Navbar parcial -->
    <div id="navbar-placeholder"></div>

    <!-- Contenido principal -->
    <main class="py-4">
        <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
            <h3 class="fw-bold">üì¶ Gesti√≥n de Stock</h3>

            <div class="d-flex gap-2">
                <input type="text" id="buscarProducto" class="form-control" placeholder="üîç Buscar producto"
                    autocomplete="off">
                <button class="btn btn-primary solo-admin" id="btnAgregar" data-bs-toggle="modal"
                    data-bs-target="#modalAgregarProducto">
                    ‚ûï Agregar Producto
                </button>
            </div>
        </div>

        <!-- Reposici√≥n / Nota de Reposici√≥n (solo admin) -->
        <div class="card mb-4 solo-admin">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span class="fw-semibold">üìù Nota de Reposici√≥n</span>
                <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-outline-primary" id="btnNuevaNota" data-bs-toggle="collapse"
                        data-bs-target="#reposicionPanel">Armar Nota</button>
                    <button class="btn btn-sm btn-outline-secondary" id="btnVerHistorial" data-bs-toggle="modal"
                        data-bs-target="#modalHistorialReposiciones">Historial</button>
                </div>
            </div>
            <div class="collapse" id="reposicionPanel">
                <div class="card-body">
                    <form id="formAgregarItemReposicion" class="row g-3 align-items-end">
                        <div class="col-md-4">
                            <label class="form-label">Producto</label>
                            <input list="listaProductosReposicion" class="form-control" id="reposicionProducto"
                                placeholder="Buscar / seleccionar" autocomplete="off" required>
                            <datalist id="listaProductosReposicion"></datalist>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Cantidad</label>
                            <input type="number" min="1" class="form-control" id="reposicionCantidad" value="1"
                                required>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Precio Compra</label>
                            <input type="text" class="form-control text-end" id="reposicionPrecioCompra" placeholder="0"
                                autocomplete="off">
                            <small class="text-muted">Opcional</small>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Precio Venta</label>
                            <input type="text" class="form-control text-end" id="reposicionPrecioVenta" placeholder="0"
                                autocomplete="off">
                            <small class="text-muted">Opcional</small>
                        </div>
                        <div class="col-md-2 text-end">
                            <button type="submit" class="btn btn-success w-100">‚ûï Agregar</button>
                        </div>
                    </form>
                    <hr>
                    <div class="table-responsive">
                        <table class="table table-sm table-striped align-middle">
                            <thead class="table-dark">
                                <tr>
                                    <th>Producto</th>
                                    <th class="text-center">Cant.</th>
                                    <th class="text-end">Precio Compra</th>
                                    <th class="text-end">Precio Venta</th>
                                    <th class="text-end">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="reposicionTable"></tbody>

                        </table>
                    </div>
                    <div class="text-end mt-2">
                        <button class="btn btn-primary" id="btnConfirmarReposicion" disabled>‚úÖ Confirmar
                            Reposici√≥n</button>
                        <button class="btn btn-outline-danger" id="btnCancelarReposicion" disabled>‚úñ Cancelar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabla de productos -->
        <div class="table-responsive shadow-sm">
            <table class="table table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Producto</th>
                        <th>Categor√≠a</th>
                        <th>C√≥digo de Barra</th>
                        <th class="text-center">Stock</th>
                        <th class="text-end">Precio Compra</th>
                        <th class="text-end">Precio Venta</th>
                        <th class="text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody id="stockTable">
                </tbody>
            </table>
        </div>

        <!-- Controles de Paginaci√≥n -->
        <div class="d-flex justify-content-between align-items-center mt-3">
            <div>
                <small class="text-muted" id="infoPaginacion">Mostrando 0 de 0 productos</small>
            </div>
            <nav aria-label="Paginaci√≥n de productos">
                <ul class="pagination pagination-sm mb-0" id="paginacionControles">
                    <!-- Se generar√° din√°micamente -->
                </ul>
            </nav>
        </div>
    </main>

    <!-- Modal Historial Reposiciones -->
    <div class="modal fade" id="modalHistorialReposiciones" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-secondary text-white">
                    <h5 class="modal-title">Historial de Notas de Reposici√≥n</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-sm table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>Fecha</th>
                                    <th>Usuario</th>
                                    <th>Items</th>
                                    <th>Total Compra</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="historialReposicionesTable"></tbody>
                        </table>
                    </div>
                    <small class="text-muted">Se muestran las √∫ltimas 50 reposiciones.</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Agregar Producto -->
    <div class="modal fade" id="modalAgregarProducto" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Agregar Producto</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="registrarStockForm">
                        <div class="mb-3">
                            <label class="form-label">Nombre del Producto</label>
                            <input type="text" id="nuevoItemStock" class="form-control"
                                placeholder="Ej: Lomito Completo" required autocomplete="off">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Categor√≠a</label>
                            <select class="form-select" required id="nuevoCategoriaStock">
                                <option>Comida</option>
                                <option>Bebida</option>
                                <option>Postres</option>
                                <option>Helados</option>
                                <option>Dulces / Bombones</option>
                                <option>Snacks</option>
                                <option>Combos</option>
                                <option>Promociones</option>
                                <option>Insumos / Materia Prima</option>
                                <option>Utensilios / Equipamiento</option>
                                <option>Otros</option>
                            </select>

                        </div>

                        <div class="mb-3">
                            <label class="form-label">Stock</label>
                            <input type="number" id="nuevoCantidadStock" required class="form-control text-center"
                                placeholder="0">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Precio Compra</label>
                            <input type="text" value="0" autocomplete="off" required id="nuevoPrecioCompraStock"
                                class="form-control text-end" placeholder="0">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Precio Venta</label>
                            <input type="text" value="0" autocomplete="off" required id="nuevoCostoStock"
                                class="form-control text-end" placeholder="0">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">C√≥digo de Barra</label>
                            <input type="number" id="nuevoCodigoBarraStock" class="form-control"
                                placeholder="Tickear codigo de barra aqui!!" required autocomplete="off">
                        </div>

                        <div class="modal-footer">
                            <button type="submit" class="btn btn-success" data-bs-dismiss="modal">Agregar</button>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>


    <!-- Modal actualizar Producto -->
    <div class="modal fade" id="modalActualizarProducto" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Actualizar Producto <span
                            class="badge rounded-pill bg-warning text-dark ms-2">Solo precio de venta</span></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="actualizarStockForm">
                        <div class="mb-3">
                            <label class="form-label">Nombre del Producto</label>
                            <input type="text" id="actualizarItemStock" class="form-control"
                                placeholder="Ej: Lomito Completo" required autocomplete="off" readonly>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Categor√≠a</label>
                            <select class="form-select" required id="actualizarCategoriaStock" disabled>
                                <option>Comida</option>
                                <option>Bebida</option>
                                <option>Postres</option>
                                <option>Helados</option>
                                <option>Dulces / Bombones</option>
                                <option>Snacks</option>
                                <option>Combos</option>
                                <option>Promociones</option>
                                <option>Insumos / Materia Prima</option>
                                <option>Utensilios / Equipamiento</option>
                                <option>Otros</option>
                            </select>
                        </div>

                        <!-- Campo de Stock removido: la cantidad se gestiona desde reposici√≥n/otras acciones -->

                        <div class="mb-3">
                            <label class="form-label">Precio Compra</label>
                            <input type="text" value="0" autocomplete="off" required id="actualizarPrecioCompraStock"
                                class="form-control text-end" placeholder="0" disabled>
                            <small class="text-muted">Solo modifique precios en este modal.</small>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Precio Venta</label>
                            <input type="text" autocomplete="off" required id="actualizarCostoStock"
                                class="form-control text-end" placeholder="0">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">C√≥digo de Barra</label>
                            <input type="number" id="actualizarCodigoBarraStock" class="form-control"
                                placeholder="Tickear codigo de barra aqui!!" required autocomplete="off" readonly>
                        </div>

                        <div class="modal-footer">
                            <button type="submit" class="btn btn-success" data-bs-dismiss="modal">Actualizar</button>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3 mt-auto">
        <small>¬© 2025 Todos los derechos reservados | Creado por <strong>AlanDevPy</strong></small>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="../js/navbar.js"></script>

    <!-- Toastify JS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <!-- Day.js -->
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>

    <!-- Custom JS -->
    <script type="module" src="../js/stock.js"></script>

    <!-- Cache Debug (solo en desarrollo) -->
    <script type="module" src="../js/cache-debug.js"></script>
</body>

</html>